<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <title>Soporte Analitek Industrial Research</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <style>
    html,body{height:100%;margin:0;background:#fff;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif}
    #app{height:100vh}
    /* Oculta burbuja y fuerza panel a full page */
    .woot-widget-bubble, #chatwoot-widget-bubble { display:none !important; }
    .woot-widget-holder, .woot-widget--expanded, .woot-widget-container, #chatwoot_live_chat_widget {
      width:100% !important; height:100% !important; max-height:100% !important;
      opacity:1 !important; transform:none !important; visibility:visible !important; display:block !important;
      position:fixed !important; inset:0 !important; z-index:9999 !important; background:#fff !important;
    }
  </style>
</head>
<body>
  <div id="app"></div>

  <script>
    // Lee ?q= (por si quieres guardar como atributo)
    const q = new URLSearchParams(location.search).get('q') || '';
    const initial = String(q).slice(0,800).trim();

    // Config SDK (la UI real se controla dentro del widget, la burbuja la ocultamos con CSS)
    window.chatwootSettings = {
      hideMessageBubble: true,
      position: 'right',
      locale: 'es',
      type: 'expanded_bubble'
    };

    (function(d,t){
      const BASE_URL = 'https://app.chatwoot.com';           // <-- reemplaza
      const WEBSITE_TOKEN = 'mD7qxxcVwCVu4nCHRAnKw1hX'; // <-- reemplaza

      const s1 = d.createElement(t); s1.async = true;
      s1.src = BASE_URL + '/packs/js/sdk.js';
      d.head.appendChild(s1);

      s1.onload = function () {
        // 1) Arrancar el widget
        window.chatwootSDK.run({ baseUrl: BASE_URL, websiteToken: WEBSITE_TOKEN });

        // 2) Handler cuando el widget está listo
        function onReady() {
          try {
            // Abre el panel (toggle sin argumentos abre/colapsa; 'open' abre explícitamente en builds recientes)
            if (typeof window.$chatwoot?.toggle === 'function') {
              try { window.$chatwoot.toggle('open'); }
              catch { window.$chatwoot.toggle(); }
            }
            // Guarda atributos (útiles en el panel del contacto)
            if (typeof window.$chatwoot?.setCustomAttributes === 'function') {
              window.$chatwoot.setCustomAttributes({
                source: 'proxy-fullpage',
                q: initial,
                startedAt: new Date().toISOString(),
              });
            }
          } catch (e) {
            console.warn('[chatwoot] ready handler error:', e);
          }
        }

        // 3) Suscribirse correctamente (NUNCA $chatwoot.on)
        if (window.chatwootSDK?.on) {
          window.chatwootSDK.on('ready', onReady);
        }
        // Fallback por si tu build sólo dispara evento DOM
        window.addEventListener('chatwoot:ready', onReady);
      };
    })(document,'script');
  </script>
</body>
</html>
