<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <title>Soporte Analitek Industrial Research</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <style>
    html,body{height:100%;margin:0;background:#fff;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif}
    #app{height:100vh}
    /* Oculta el launcher */
    .woot-widget-bubble, #chatwoot-widget-bubble { display:none !important; }
    /* Fuerza el panel visible y a pantalla completa */
    .woot-widget-holder, .woot-widget--expanded, .woot-widget-container, #chatwoot_live_chat_widget {
      width:100% !important; height:100% !important; max-height:100% !important;
      opacity:1 !important; transform:none !important; visibility:visible !important; display:block !important;
      position:fixed !important; inset:0 !important; z-index:9999 !important;
      background:#fff !important;
    }
  </style>
</head>
<body>
  <div id="app"></div>

  <script>
    // 1) Lee ?q=
    const q = new URLSearchParams(location.search).get('q') || '';
    const initial = String(q).slice(0,800).trim();

    // 2) Config de Chatwoot SDK
    window.chatwootSettings = {
      hideMessageBubble: true,      // sin burbuja
      position: 'right',
      locale: 'es',
      type: 'expanded_bubble',      // ayuda a forzar expansión
      launcherTitle: 'Soporte',
    };

    // 3) Carga SDK y abre automáticamente
    (function(d,t){
      var BASE_URL = 'https://app.chatwoot.com';              // p.ej. https://app.chatwoot.com
      var g=d.createElement(t), s=d.getElementsByTagName(t)[0];
      g.src = BASE_URL + '/packs/js/sdk.js'; s.parentNode.insertBefore(g,s);
      g.onload = function(){
        window.chatwootSDK.run({ websiteToken: 'mD7qxxcVwCVu4nCHRAnKw1hX', baseUrl: BASE_URL });

        // Cuando el SDK esté listo, abre el panel y anota atributos útiles
        window.$chatwoot.on('ready', function() {
          try { window.$chatwoot.toggle('open'); } catch(e) { try{ window.$chatwoot.toggle(); }catch(_){} }

          // Atributos personalizados: verás esto en el panel de chatwoot del contacto
          window.$chatwoot.setCustomAttributes({
            source: 'proxy-fullpage',
            q: initial,
            startedAt: new Date().toISOString(),
          });

          // (Opcional) muestra un saludo en el widget (sin enviar automáticamente)
          // window.$chatwoot.addCustomAttributes({ greeting: `Recibido: ${initial}` });
        });
      };
    })(document,'script');
  </script>
</body>
</html>
