<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <title>Soporte Analitek Industrial Research</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <style>
    html,body{height:100%;margin:0;background:#fff;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif}
    #app{height:100vh}
    /* Oculta el launcher */
    .woot-widget-bubble, #chatwoot-widget-bubble { display:none !important; }
    /* Fuerza panel a pantalla completa */
    .woot-widget-holder, .woot-widget--expanded, .woot-widget-container, #chatwoot_live_chat_widget {
      width:100% !important; height:100% !important; max-height:100% !important;
      opacity:1 !important; transform:none !important; visibility:visible !important; display:block !important;
      position:fixed !important; inset:0 !important; z-index:9999 !important; background:#fff !important;
    }
  </style>
</head>
<body>
  <div id="app"></div>

  <script>
    // 1) Lee ?q=
    const q = new URLSearchParams(location.search).get('q') || '';
    const initial = String(q).slice(0,800).trim();

    // 2) Config del SDK
    window.chatwootSettings = {
      hideMessageBubble: true,     // sin burbuja
      position: 'right',
      locale: 'es',
      type: 'expanded_bubble',     // ayuda a que arranque expandido
      launcherTitle: 'Soporte',
    };

    // 3) Cargar SDK y arrancar
    (function(d,t){
      const BASE_URL = 'https://app.chatwoot.com';              // ej: https://app.chatwoot.com o tu dominio
      const WEBSITE_TOKEN = 'mD7qxxcVwCVu4nCHRAnKw1hX';    // token de tu Website Inbox
      const g=d.createElement(t), s=d.getElementsByTagName(t)[0];
      g.src = BASE_URL + '/packs/js/sdk.js'; s.parentNode.insertBefore(g,s);

      // ✅ el listener va en chatwootSDK, NO en $chatwoot
      g.onload = function(){
        window.chatwootSDK.run({ websiteToken: WEBSITE_TOKEN, baseUrl: BASE_URL });

        // Opción A: API del SDK
        window.chatwootSDK.on && window.chatwootSDK.on('ready', function () {
          try { window.$chatwoot.toggle('open'); } catch (_) { try { window.$chatwoot.toggle(); } catch(_) {} }

          // guardar info útil para el agente / operador
          try {
            window.$chatwoot.setCustomAttributes({
              source: 'proxy-fullpage',
              q: initial,
              startedAt: new Date().toISOString(),
            });
          } catch(_){}
        });

        // Opción B: evento del DOM (fallback)
        window.addEventListener('chatwoot:ready', function () {
          try { window.$chatwoot.toggle('open'); } catch (_) { try { window.$chatwoot.toggle(); } catch(_) {} }
          try {
            window.$chatwoot.setCustomAttributes({
              source: 'proxy-fullpage',
              q: initial,
              startedAt: new Date().toISOString(),
            });
          } catch(_){}
        });
      };
    })(document,'script');
  </script>
</body>
</html>
